{% extends 'master.html' %}

{% block content %}

<header>
    <div class="container">
        <nav>
            <a class="logo">Romdoul Shop</a>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/product">Products</a></li>
                <li><a href="/about_us">About Us</a></li>
                <li><a href="/contact_us">Contact Us</a></li>
            </ul>
            <div class="mobile-menu">
                <i class="fas fa-bars"></i>
            </div>
        </nav>
    </div>
</header>

<main class="container">
    <section class="products">
        <h3 class="section-title">All Products</h3>

        <div class="product-grid">
            {% for item in products %}
            <div class="product-card">

                <div class="discount" data-category="{{ item.category.name }}">
                    Category {{ item.category.name }}
                </div>

                {% if item.image %}
                <img src="/static/images/product/{{ item.image }}"
                     alt="{{ item.name }}"
                     style="height: 200px; object-fit: contain;"
                     onerror="this.style.display='none'">
                {% endif %}

                <a href="/product_detail/{{ item.id }}" class="product-title">
                    {{ item.name }}
                </a>

                <p>${{ "%.2f"|format(item.price|float) }}</p>

                <input
                    type="button"
                    value="Add to Cart"
                    class="btn-add-to-cart"
                    id="add-to-cart-{{ item.id }}"
                    name="add-to-cart"
                    data-id="{{ item.id }}"
                    data-title="{{ item.name }}"
                    data-price="{{ item.price }}"
                    data-image="{{ item.image }}"
                >
            </div>
            {% endfor %}
        </div>
    </section>
</main>

{% endblock %}




{% block custom_script %}
<script>
function countCartItem() {
    let carts_count = (JSON.parse(localStorage.getItem('carts')) || []).length;
    document.getElementById('btn-card').innerText = `Cart(${carts_count})`;
}

// Run once on page load
countCartItem();

// Add this inside your add-to-cart code
document.querySelectorAll('.btn-add-to-cart').forEach(button => {
    button.addEventListener('click', function () {

        const product = {
            id: this.dataset.id,
            title: this.dataset.title,
            price: parseFloat(this.dataset.price),
            image: this.dataset.image,
            quantity: 1
        };

        let carts = JSON.parse(localStorage.getItem('carts')) || [];

        const existingIndex = carts.findIndex(item => item.id === product.id);

        if (existingIndex >= 0) {
            carts[existingIndex].quantity += 1;
        } else {
            carts.push(product);
        }

        localStorage.setItem('carts', JSON.stringify(carts));

        // Update cart count immediately
        countCartItem();
    });
});
</script>

{% endblock %}
